#pragma once
#include <hal/teensy/lib/TinyGPSPlus/TinyGPSPlus.h>

#include <utils/srimb_topics/gps_topic/gps_topic.hpp>

#include <hal/HAL.hpp>

// ---------- UBX COMMANDS ----------

// Set rate = 10Hz
const uint8_t UBX_CFG_RATE_10HZ[] = {
    0xB5, 0x62, 0x06, 0x08, 0x06, 0x00,
    0x64, 0x00, // 100 ms = 10Hz
    0x01, 0x00,
    0x01, 0x00,
    0x7A, 0x12};

// Disable NMEA messages (reduce bandwidth)
const uint8_t UBX_DISABLE_GLL[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x01, 0x00, 0xFB, 0x11};
const uint8_t UBX_DISABLE_GSA[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x02, 0x00, 0xFC, 0x13};
const uint8_t UBX_DISABLE_GSV[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x03, 0x00, 0xFD, 0x15};
const uint8_t UBX_DISABLE_VTG[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x05, 0x00, 0xFF, 0x19};


class Bn280_driver : public HAL_GPS
{
private:
    Stream *_serial_ptr;
    TinyGPSPlus _gps;

    void _send_UBX(const uint8_t *msg, uint8_t len);
public:
    Bn280_driver();
    ~Bn280_driver();

    bool init(Stream *serialPtr) override;

    GpsData read() override;
};